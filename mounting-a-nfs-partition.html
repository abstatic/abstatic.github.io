<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

    <title>Coding Mantis</title>

    <meta charset="utf-8" />
    <link href="https://abstatic.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Coding Mantis Full Atom Feed" />
    <link href="https://abstatic.github.io/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Coding Mantis Full RSS Feed" />
    <link href="https://abstatic.github.io/feeds/linux.atom.xml" type="application/atom+xml" rel="alternate" title="Coding Mantis Categories Atom Feed" />
    <link rel="stylesheet" href="https://abstatic.github.io/theme/css/poole.css"/>
    <link rel="stylesheet" href="https://abstatic.github.io/theme/css/syntax.css"/>
    <link rel="stylesheet" href="https://abstatic.github.io/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="https://abstatic.github.io/theme/css/font-awesome.css"/>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="https://abstatic.github.io/theme/css/styles.css"/>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-74287308-1', 'auto');
  ga('send', 'pageview');

</script>



    <meta name="tags" contents="nfs" />
    <meta name="tags" contents="partition" />
    <meta name="tags" contents="linux" />
    <meta name="tags" contents="networks" />

  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="https://abstatic.github.io/theme/img/profile.jpg"/>
    </div>
  </div>

  <nav class="sidebar-nav">
  <a class="sidebar-nav-item" href="/">All</a>

      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/configuration.html">Configuration</a>
      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/gsoc.html">GSoC</a>
      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/life.html">Life</a>
      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/linux.html">Linux</a>
      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/programming.html">Programming</a>
      <a class="sidebar-nav-item" href="https://abstatic.github.io/category/random.html">Random</a>

  <a class="sidebar-nav-item" href="/archives">Blog Archives</a>
  <a class="sidebar-nav-item" href="/tags">Browse By Tags</a>
  <a class="sidebar-nav-item" href="/feeds/all.rss.xml">Feeds</a>
  <a class="sidebar-nav-item" href="https://abstatic.github.io/pages/about">About</a>
  </nav>

  <div class="sidebar-item">
    <p>Follow On:</p>
    <ul style="list-style: none;">
      <li>
        <a href="https://plus.google.com/u/0/+AbhishekShrivastava1">
          <i class="fa fa-google-plus-square"></i>  Google
        </a>
      </li>
      <li>
        <a href="https://in.linkedin.com/in/abshrivastava1">
          <i class="fa fa-linkedin-square"></i>  LinkedIn
        </a>
      </li>
      <li>
        <a href="https://github.com/abstatic">
          <i class="fa fa-github-square"></i>  Github
        </a>
      </li>
      <li>
        <a href="http://stackoverflow.com/users/3594927/abhishek-m">
          <i class="fa fa-stack-overflow"></i>  StackOverflow 
        </a>
      </li>
    </ul>
    <p class="tiny-note">
      <a class="muted" href="#">© Abhishek Shrivastava</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h2 class="masthead-title">
            <a href="https://abstatic.github.io/" title="Home">Coding Mantis</a>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Mounting a <span class="caps">NFS</span>&nbsp;partition
    </h1>
    <span class="post-date">Mon 24 February 2014</span>

    <p><span class="caps">NFS</span> is network file system. It is a type of partition which allows you
to store off your data into different physical computers which are
connected via <span class="caps">LAN</span>. This is what adds to the appeal of <span class="caps">NFS</span> and makes it so
different from other <span class="caps">FS</span> types. It allows the system administrator by
availing the same <span class="caps">FS</span> to be mounted off in different&nbsp;machines.  </p>
<p>So you can see why <span class="caps">NFS</span> is so cool. Just imagine having your same home
directory on all of your machines , and that too without needing extra
disk space&nbsp;!  </p>
<p>Setting up <span class="caps">NFS</span> is pretty easy too. To setup up <span class="caps">NFS</span> you need atleast one
server and one client. I used Fedora 20, as my server and a CentOS 6.5
based <span class="caps">VM</span> as my client. to be honest it took me nearly 5 hours to
configure <span class="caps">NFS</span> on these&nbsp;machines.  </p>
<p>First of all you need to install the packages  for <span class="caps">NFS</span> on both of the
machines. To do that you would&nbsp;execute  </p>
<div class="highlight"><pre><span></span>sudo yum install nfs-utils nfs-utils-lib
sudo yum install portmap (not required with NFSv4)
</pre></div>


<p>Now start the services&nbsp;by:-  </p>
<div class="highlight"><pre><span></span>service nfs start
service rpcbind start
</pre></div>


<p>You might be thinking why do we  need to start the <span class="caps">RPC</span> (Remote
Procedure Call) service ? Its because its the backbone of <span class="caps">NFS</span> suite. All
of its services are provided via the help of <span class="caps">RPC</span>.  </p>
<p><strong>Setting up the <span class="caps">NFS</span>&nbsp;server:</strong></p>
<p>After that you need to edit your /etc/exports file on your server. This
file contains the information about what directories the server will
share via <span class="caps">NFS</span> and with whom it will share. You need to be the super user
to edit the exports&nbsp;file.  </p>
<p>The syntax of an exports file entry looks like&nbsp;this  </p>
<p><code>directory client-ip(Permissions)</code><br>
<code>Example: /home/xxx/music 172.164.145.555(rw,no\_root\_squash,sync)</code></p>
<p>In the above example, there is a directory in <strong>/</strong> partition named
“<strong>nfsshare</strong>” is being shared with client <span class="caps">IP</span> “172.164.145.555&#8221; with
<strong>read</strong> and <strong>write</strong> (<strong>rw</strong>) privilege, you can also use <strong>hostname</strong>
of the client in the place of <strong><span class="caps">IP</span></strong> in above&nbsp;example.  </p>
<p><strong><span class="caps">NFS</span>&nbsp;Options</span></strong></p>
<p>Some other options we can use in “<strong>/etc/exports</strong>” file for file
sharing is as&nbsp;follows:  </p>
<ol>
<li>
<p><strong>ro</strong>: With the help of this option we can provide <strong>read only
    access</strong> to the shared files i.e <strong>client</strong> will only be able to
    <strong>read</strong>.</p>
</li>
<li>
<p><strong>rw</strong>: This option allows the <strong>client server</strong> to both <strong>read</strong>
    and <strong>write</strong> access within the shared&nbsp;directory.</p>
</li>
<li>
<p><strong>sync</strong>: Sync confirms requests to the shared directory only once
    the <strong>changes</strong> have been&nbsp;committed.</p>
</li>
<li>
<p><strong>no_subtree_check</strong>: This option prevents the <strong>subtree</strong>
    checking. When a shared directory is the subdirectory of a larger
    file system, <strong>nfs</strong> performs scans of every directory above it, in
    order to verify its permissions and details. Disabling the
    <strong>subtree</strong> check may increase the reliability of <strong><span class="caps">NFS</span></strong>, but
    reduce <strong>security</strong>.</p>
</li>
<li>
<p><strong>no_root_squash</strong>: This phrase allows <strong>root</strong> to <strong>connect</strong> to
    the designated directory. Be careful though, sometimes you might not
    want to give root&nbsp;access.</p>
</li>
</ol>
<p>For more options with “<strong>/etc/exports</strong>“, you are recommended to read
the <strong>man pages</strong> for <strong>export</strong>.  </p>
<p>Now, if your server is a fedora machine then you also need to follow
these additional&nbsp;steps:</p>
<ul>
<li>
<p>Add the list of allowed clients in your <em>/etc/hosts.allow</em> file. The syntax for addition in this file is:<br>
<code>name-of-service clients_allowed_ip</code></p>
<p>In my configuration I had the following&nbsp;entries  </p>
<div class="highlight"><pre><span></span><span class="n">portmap</span><span class="o">:</span> <span class="n">ALL</span>  
<span class="n">rpc</span><span class="o">.</span><span class="na">mountd</span><span class="o">:</span> <span class="n">ALL</span>  
<span class="n">rpc</span><span class="o">.</span><span class="na">nfsd</span><span class="o">:</span> <span class="n">ALL</span>
</pre></div>


<p>Here the <span class="caps">ALL</span> keyword indicates that everyone can access these&nbsp;services.  </p>
</li>
<li>
<p>After setting up the hosts.allow file. We need to configure nfs
    config file stored in <em>/etc/sysconfig/nfs</em><br>
   In this config files we need to explicitely specify what ports will
    be used in <span class="caps">NFS</span>.  </p>
</li>
</ul>
<p>All in all, your nfs config file must have the following entries&nbsp;(uncommented)</p>
<div class="highlight"><pre><span></span>    MOUNTD_PORT=892               
    STATD_PORT=662                          
    STATD_OUTGOING_PORT=2020  
    LOCKD_TCPPORT=32803              
    LOCKD_UDPPORT=32769
</pre></div>


<ul>
<li>Now we need to deal with the overhelpful firewall of fedora. We need to adjust the iptables such that the ports used in <span class="caps">NFS</span> are&nbsp;open.   </li>
</ul>
<p>To do that, fire up your firewall <span class="caps">GUI</span> daemon, and add ports
    2049(<span class="caps">NFS</span>) and 111(<span class="caps">RPC</span>) as open ports. You need to open these ports
    to <span class="caps">TCP</span> as well as <span class="caps">UDP</span>&nbsp;protocols.  </p>
<p>After this we need to edit the iptables file. Generally its found in
    <em>/etc/sysconfig/</em>  </p>
<p>Add the following entries to your iptables&nbsp;file:  </p>
<div class="highlight"><pre><span></span>   -A INPUT -m state --state NEW -m udp -p udp --dport 2049 -j ACCEPT     
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 2049 -j ACCEPT  
   -A INPUT -m state --state NEW -m udp -p udp --dport 111 -j ACCEPT 
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 111 -j ACCEPT   
   -A INPUT -m state --state NEW -m udp -p udp --dport 892 -j ACCEPT       
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 892 -j ACCEPT         
   -A INPUT -m state --state NEW -m udp -p udp --dport 875 -j ACCEPT       
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 875 -j ACCEPT         
   -A INPUT -m state --state NEW -m udp -p udp --dport 662 -j ACCEPT       
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 662 -j ACCEPT 
   -A INPUT -m state --state NEW -m tcp -p tcp --dport 32803 -j ACCEPT     
   -A INPUT -m state --state NEW -m udp -p udp --dport 32769 -j ACCEPT
</pre></div>


<ul>
<li>
<p>Now restart your firewall by:<br>
<code>service iptables restart</code></p>
<p>And we&#8217;re done ! , With the Server configuration of course&nbsp;:P</p>
</li>
</ul>
<p><strong><u>Setting up the <span class="caps">NFS</span> client</u></strong></p>
<p>After configuring the <strong><span class="caps">NFS</span></strong> server, we need to <strong>mount</strong> that shared
directory or partition in the <strong>client</strong>&nbsp;server.  </p>
<h4>Mount Shared Directories on <span class="caps">NFS</span>&nbsp;Client</h4>
<p>Now at the <strong><span class="caps">NFS</span> client</strong> end, we need to <strong>mount</strong> that directory in
our server to access it locally. To do so, first we need to find out
that shares available on the remote server or <span class="caps">NFS</span>&nbsp;Server.  </p>
<p>showmount -e 192.168.0.100
Export list for 192.168.0.100:/nfsshare&nbsp;192.168.0.101</p>
<p>Now, create the directory that will contain the <span class="caps">NFS</span> shared&nbsp;files   </p>
<p><code>mkdir -p /mnt/nfs/home</code></p>
<p>Now at the <strong><span class="caps">NFS</span> client</strong> end, we need to <strong>mount</strong> that directory in
our server to access it locally. To do so, first we need to find out
that shares available on the remote server or <span class="caps">NFS</span>&nbsp;Server.   </p>
<div class="highlight"><pre><span></span>showmount -e 192.168.0.100
&gt;&gt;Export list for 192.168.0.100:/nfsshare 192.168.0.101
</pre></div>


<p>Then go ahead and mount&nbsp;it:</p>
<div class="highlight"><pre><span></span>mount &lt;ip-address_of_host&gt;:&lt;directory_in_exportsfile&gt; &lt;where_to_mount&gt;
Example: mount 12.34.56.789:/home /mnt/nfs/home
</pre></div>


<p>If you are having problems then try stopping your firewall daemon by&nbsp;using  </p>
<p><code>service iptables stop</code></p>
<p>If all goes well then you will be able to access all the information
stored in your&nbsp;server.</p>
  </div>
</div>
    <div class="comments">
      <h1>Comments</h1>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_identifier = "mounting-a-nfs-partition.html";
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://codingmantis.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
    </div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>
     </div>
  </body>
</html>